<html>

<head>
    <title>Using pb-autocomplete</title>
    <style>
        pb-autocomplete {
            margin-bottom: 20px;
        }

        pb-repeat .instance {
            display: flex;
            align-items: center;
        }

    </style>
    <script type="module" src="../pb-components-bundle.js"></script>
</head>

<body>
    <h1>Using pb-autocomplete with remote suggestions</h1>

    <pb-demo-snippet>
        <template>
            <pb-page locales="../i18n/{{ns}}/{{lng}}.json" endpoint="https://teipublisher.com/exist/apps/tei-publisher" api-version="1.0.0">
                <form action="" id="form">
                        <p>pb-autocomplete used with a pb-repeat:</p>
                        <pb-repeat>
                            <template>
                                <!--pb-autocomplete placeholder="Title" name="title" source="modules/autocomplete.xql"></pb-autocomplete-->
                                <pb-autocomplete placeholder="Title" name="title"
                                    source="api/search/autocomplete"></pb-autocomplete>
                            </template>
                        </pb-repeat>
                        <p>If suggestions are an array of objects with properties "text" and "value", the "value" will
                            be used
                            in the form submit instead of the label displayed:
                        </p>
                        <pb-autocomplete name="lang" placeholder="Language" value="pl" icon="icons:flag"
                            suggestions='[{"text": "English", "value": "en"}, {"text": "Polish", "value": "pl"}, {"text": "German", "value": "de"}]'>
                        </pb-autocomplete>
                        <button type="submit" class="pb-button pb-button--contained">Submit</button>
                    </form>
                <p>Parameters which would be sent: <code id="output"></code></p>
            </pb-page>
        </template>
    </pb-demo-snippet>
    <script type="module">
      import { ready, stampIfNeeded, wireFormOutput, firePageReady } from '../src/docs/demo-utils.js'
      async function hydrate () {
        await ready(['pb-demo-snippet','pb-autocomplete'])
        const snippet = document.querySelector('pb-demo-snippet')
        stampIfNeeded(snippet)
        const form = document.getElementById('form')
        const output = document.getElementById('output')
        if (form && output) {
          const render = () => { output.textContent = JSON.stringify({ ...Object.fromEntries(new FormData(form)) }) }
          form.addEventListener('submit', ev => { ev.preventDefault(); render() })
          render()
        }
        firePageReady({ endpoint: '/exist/apps/tei-publisher', apiVersion: '1.0.0' })
      }
      if (document.readyState === 'loading') document.addEventListener('DOMContentLoaded', hydrate)
      else hydrate()
    </script>
</body>

</html>
