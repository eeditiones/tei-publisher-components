<html>

<head>
    <title>Using pb-autocomplete</title>
    <style>
        pb-autocomplete {
            margin-bottom: 20px;
        }

        pb-repeat .instance {
            display: flex;
            align-items: center;
        }

        button {
            border: 0;
            background-color: inherit;
        }
    </style>
    <!--scripts-->
    <script>
        // Workaround for Polymer modules under Vite: some @polymer/* packages
        // reference this Closure helper; define a no-op if absent.
        // See: https://github.com/Polymer/polymer/issues/4845
        window.JSCompiler_renameProperty = window.JSCompiler_renameProperty || function (prop, obj) { return prop; };
    </script>
    <script type="module">
        import '@polymer/paper-button/paper-button.js';
        import '@polymer/iron-form/iron-form.js';
    </script>
    <script type="module" src="../src/docs/pb-demo-snippet.js"></script>
    <script type="module" src="../src/pb-page.js"></script>
    <script type="module" src="../src/pb-autocomplete.js"></script>
    <script type="module" src="../src/pb-repeat.js"></script>

    <!--/scripts-->
</head>

<body>
    <h1>Using pb-autocomplete with remote suggestions</h1>

    <pb-demo-snippet>
        <template>
            <pb-page locales="../i18n/{{ns}}/{{lng}}.json" endpoint="/exist/apps/tei-publisher">
                <iron-form id="form">
                    <form action="">
                        <p>pb-autocomplete used with a pb-repeat:</p>
                        <pb-repeat>
                            <template>
                                <!--pb-autocomplete placeholder="Title" name="title" source="modules/autocomplete.xql"></pb-autocomplete-->
                                <pb-autocomplete placeholder="Title" name="title"
                                    source="api/search/autocomplete"></pb-autocomplete>
                            </template>
                        </pb-repeat>
                        <p>If suggestions are an array of objects with properties "text" and "value", the "value" will
                            be used
                            in the form submit instead of the label displayed:
                        </p>
                        <pb-autocomplete name="lang" placeholder="Language" value="pl" icon="icons:flag"
                            suggestions='[{"text": "English", "value": "en"}, {"text": "Polish", "value": "pl"}, {"text": "German", "value": "de"}]'>
                        </pb-autocomplete>
                        <button type="submit"><paper-button>Submit</paper-button></button>
                    </form>
                </iron-form>
                <p>Parameters which would be sent: <code id="output"></code></p>
            </pb-page>
        </template>
    </pb-demo-snippet>
    <script type="module">
      import { ready, stampIfNeeded, wireFormOutput, firePageReady } from '../src/docs/demo-utils.js'
      async function hydrate () {
        await ready(['pb-demo-snippet','pb-autocomplete'])
        const snippet = document.querySelector('pb-demo-snippet')
        stampIfNeeded(snippet)
        const iron = document.getElementById('form')
        const form = iron?.querySelector('form')
        const output = document.getElementById('output')
        if (form && output) {
          const render = () => { output.textContent = JSON.stringify({ ...Object.fromEntries(new FormData(form)) }) }
          iron.addEventListener('iron-form-submit', ev => { ev.preventDefault(); render() })
          render()
        }
        firePageReady({ endpoint: '/exist/apps/tei-publisher', apiVersion: '1.0.0' })
      }
      if (document.readyState === 'loading') document.addEventListener('DOMContentLoaded', hydrate)
      else hydrate()
    </script>
</body>

</html>
